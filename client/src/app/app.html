<!-- TOOLBAR -->
<div class="toolbar" (mousedown)="$event.stopPropagation()">
  <span class="toolbar-brand">Measure</span>

  <div class="toolbar-actions">
    <button type="button" (click)="setDrawMode('LineString')">Draw Line</button>
    <button type="button" (click)="setDrawMode('Polygon')">Draw Polygon</button>
    <button type="button" class="btn-finish" (click)="finishDrawing()">Finish</button>
    <button type="button" class="btn-reset" (click)="reset()">Reset</button>
    <button type="button" class="btn-delete-data" (click)="deleteLastMeasurement()">Delete data</button>
    <button type="button" class="btn-download" [disabled]="!canDownload" (click)="downloadData()">Download</button>
    <button type="button"
            class="btn-instructions"
            type="button"
            (click)="openInstructions(); $event.stopPropagation()">
      Instructions
    </button>
  </div>

  <span class="info">{{ lastInfo ?? '—' }}</span>
</div>

<!-- INSTRUCTIONS OVERLAY - always in DOM, visibility toggled so it always works -->
<section class="instructions-window"
         [class.instructions-window-visible]="showInstructions"
         role="dialog"
         [attr.aria-hidden]="!showInstructions"
         tabindex="0"
         (keydown)="onKeyDown($event)">

  <!-- Dark background -->
  <div class="instructions-window-backdrop"
       (click)="closeInstructions()">
  </div>

  <!-- White/Beige popup box -->
  <div class="instructions-window-box">

    <!-- Close button (top-left as you requested) -->
    <button type="button"
            class="instructions-window-close"
            (click)="closeInstructions()">
      ×
    </button>

    <h2 class="instructions-window-title">Instructions</h2>

    <ol class="instructions-window-list">
      <li>Click <strong>Draw Line</strong> or <strong>Draw Polygon</strong>.</li>
      <li>Click on the map to add points.</li>
      <li>Double-click to finish.</li>
      <li>Click <strong>Finish</strong> to save.</li>
      <li>Click <strong>Download</strong> to export your measurements.</li>
    </ol>

  </div>
</section>

<!-- MAP -->
<main class="main-content">
  <div id="map" class="map"></div>
  <div class="attribution-bar">
    © <a href="https://www.openstreetmap.org/copyright"
         target="_blank"
         rel="noopener">
      OpenStreetMap
    </a>
    contributors. Drawings are shown in blue.
  </div>
</main>